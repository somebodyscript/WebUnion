<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Link WebUnion</title>
    <meta http-equiv="Content-Security-Policy" content="default-src *">
</head>
<body>
    function getBlockedIPs() {
    return fetch('https://somebodyscript.github.io/WebUnion/')
      .then(response => response.text())
      .then(html => {
        const parser = new DOMParser();
        const doc = parser.parseFromString(html, 'text/html');
        const ulElements = doc.querySelectorAll('ul');
        const ipList = [];
        ulElements.forEach(ul => {
          const ips = ul.textContent.split('\n').map(line => line.trim()).filter(line => line !== '');
          ipList.push(...ips);
        });
        return ipList;
      })
      .catch(error => {
        console.error('Blocked IPs retrieval error:', error);
        return [];
      });
  }

  function checkAndBlock() {
    getIPAddress().then(userIP => {
      getBlockedIPs().then(blockedIPs => {
        if (blockedIPs.includes(userIP)) {
          document.body.innerHTML = '<div class="blocked-page"><h1>Your IP is globally blocked on all WebUnion-using sites, if this is an error, please contact us on our <a href="https://discord.gg/vuD7PN8kR6">Discord server</a></h1></div>';
          applyBlockedPageStyles();
        } else {
          fetch('https://somebodyscript.github.io/WebUnion/')
            .then(response => response.text())
            .then(html => {
              const parser = new DOMParser();
              const doc = parser.parseFromString(html, 'text/html');
              const ulElements = doc.querySelectorAll('ul');
              ulElements.forEach(ul => {
                console.log('Powered by HotTea')
              });
            })
            .catch(error => console.error('Fetch error:', error));
        }
      });
    });
  }

  function applyBlockedPageStyles() {
    const style = document.createElement('style');
    style.innerHTML = `
      body {
        font-family: 'Arial', sans-serif;
        background-color: #f1f1f1;
        margin: 0;
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
      }
      
      .blocked-page {
        text-align: center;
        padding: 20px;
        background-color: #fff;
        border-radius: 8px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
      }
      
      h1 {
        color: #ff0000;
      }
    `;
    document.head.appendChild(style);
  }

  checkAndBlock();
  
</body>
</html>
